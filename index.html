<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vote Form</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #f2f2f2;
    }
    /* fixed button on the right */
    .fixed-button {
      position: fixed;
      right: 20px;   /* distance from right edge */
      bottom: 20px;  /* distance from bottom */
    }
  </style>
</head>
<body>
  

  <form id="lobby">
    <h2>Lobby</h2>
    <table>
      <thead>
        <tr>
          <th>Number</th>
          <th>Name</th>
          <th>ID</th>
          <th>Manager Role</th>
        </tr>
      </thead>
      <tbody id="lobbyBody">
        <!-- Only 1 row -->
        <tr>
          <td>1</td>
          <td>Alice</td>
          <td>12345</td>
          <td>Manager</td>
        </tr>
      </tbody>
    </table>
  </form>

  <form id="gameForm">
    <label for="numberIWant">Number I Want:</label>
    <input type="number" id="numberIWant" name="numberIWant" />
    <br><br>

    <label for="myName">My Name:</label>
    <input type="text" id="myName" name="myName" />
    <br><br>

    <button id="joinGame" type="button">Join Game</button>
  </form>

  <form id="voteForm">
    <table id="voteTable">
      <tr id="userRow"></tr>
      <!-- vote rows will be added below -->
    </table>
  </form>

  <button class="fixed-button" type="button"
          onclick="addVoteRow([1,0,1,0,0,1,0,1,0])">
    Simulate Vote
  </button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io()
    // initialize header row with 1â€“9
    

    // add a new vote row (array of 9 values: 0 or 1)
    function addVoteRow(votes) {
      const table = document.getElementById("voteTable");
      const row = document.createElement("tr");
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement("td");
        cell.textContent = votes[i] ?? "";
        row.appendChild(cell);
      }
      table.appendChild(row);
    }

    function generateId() {
      return Date.now().toString(36) + "-" + Math.random().toString(36).slice(2,8);
    }
    function getOrCreateUserId() {
      let id = localStorage.getItem("userIdYuchen");
      if (!id) {
        id = generateId();
        localStorage.setItem("userIdYuchen", id);
      }
      return id;
    }

    ///////////////////////////////////////

    const joinGame = document.getElementById("joinGame");
    const numberIWant = document.getElementById("numberIWant");
    const myName = document.getElementById("myName");

    joinGame.addEventListener("click", () => {
      if (!numberIWant.value || !myName.value) {
        alert("Please enter a number and name before joining");
        return;
      }
      if (numberIWant.value <= 0) {
        alert("Please enter a positive number");
        return;
      }
      socket.emit('ToSJoinGame', { id: getOrCreateUserId(), numberIWant: numberIWant.value, name: myName.value})
      // numberIWant.value = '';
      // name.value = '';
    });

    const userRow = document.getElementById("userRow");
    for (let i = 1; i <= 9; i++) {
      const cell = document.createElement("td");
      cell.textContent = i;
      userRow.appendChild(cell);
    }


    socket.on('ToCCurrentGame', function (data) {
      console.log(11)
      // if(data.state === "Waiting for captain") {
        const h1 = document.createElement("h1");
        h1.textContent = "Game Started!";
        h1.style.textAlign = "center";
        document.body.insertBefore(h1, document.body.firstChild);

        for(const id in data.lobby){
          addRowToLobby(data.lobby[id])
        }
      // }
    })

    function addRowToLobby(info){
      const tbody = document.getElementById("lobbyBody");
      const row = document.createElement("tr");
      const numberCell = document.createElement("td");
      numberCell.textContent = info.numberIWant
      const nameCell = document.createElement("td");
      nameCell.textContent = info.name;
      const idCell = document.createElement("td");
      idCell.textContent = info.id;
      const roleCell = document.createElement("td");
      roleCell.textContent = 'hh';

      row.appendChild(numberCell);
      row.appendChild(nameCell);
      row.appendChild(idCell);
      row.appendChild(roleCell);
      tbody.appendChild(row);
    }
  </script>
</body>
</html>
